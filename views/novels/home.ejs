<% layout("layouts/common-template") %>

<!-- 特定のCSS -->
<% head = '<link rel="stylesheet" href="/css/home.css" />' %> <%= logoutSuccess
%> <%= error %>

<!-- ブックマークメッセージ用のコンテナ -->
<div id="bookmark-message-container" class="bookmark-message-container"></div>

<% 
function getCoverUrl(novel) { 
  return novel.cover && novel.cover.length > 0 && novel.cover[0].url ? novel.cover[0].url :'https://dummyimage.com/280x300/000/fff'; 
} 
%>

<!-- コンテンツ -->
<main class="content">
  <section class="section">
    <h2>
      注目の新作<span><a href="/novel/list?is_new=true">もっと見る -></a></span>
    </h2>
    <div class="book-list">
      <% for (let novel of newNovels) { %>
      <div class="book-item">
        <div class="book-cover">
          <a href="/novel/detail/<%= novel._id %>"
            ><img
              src="<%= getCoverUrl(novel) %>"
              alt="<%= novel.title %>の表紙"
          /></a>
          <form class="bookmark-form" data-novel-id="<%= novel._id %>">
            <!-- <input type="hidden" name="novelId" value="<%= novel._id  %>"> -->
            <button class="bookmark-button" type="submit">読みたい＋</button>
          </form>
        </div>
        <p><%= novel.title %></p>
        <p><%= novel.author.author_name %></p>
      </div>
      <% } %>
    </div>

    <h2>
      おすすめの文庫<span
        ><a href="/novel/list?novel_type=文庫">もっと見る -></a></span
      >
    </h2>
    <div class="book-list">
      <% for (let novel of bunkoNovels) { %>
      <div class="book-item">
        <div class="book-cover">
          <a href="/novel/detail/<%= novel._id %>"
            ><img
              src="<%= getCoverUrl(novel) %>"
              alt="<%= novel.title %>の表紙"
          /></a>
          <form action="/user/bookmark" method="post">
            <button class="bookmark-button">読みたい＋</button>
          </form>
        </div>
        <p><%= novel.title %></p>
        <p><%= novel.author.author_name %></p>
      </div>
      <% } %>
    </div>

    <h2>
      おすすめの単行本<span
        ><a href="/novel/list?novel_type=単行本">もっと見る -></a></span
      >
    </h2>
    <div class="book-list">
      <% for (let novel of tankobonNovels) { %>
      <div class="book-item">
        <div class="book-cover">
          <a href="/novel/detail/<%= novel._id %>"
            ><img
              src="<%= getCoverUrl(novel) %>"
              alt="<%= novel.title %>の表紙"
          /></a>
          <form action="/user/bookmark" method="post">
            <button class="bookmark-button">読みたい＋</button>
          </form>
        </div>
        <p><%= novel.title %></p>
        <p><%= novel.author.author_name %></p>
      </div>
      <% } %>
    </div>

    <h2>
      おすすめのライトノベル<span
        ><a href="/novel/list?novel_type=ライトノベル">もっと見る -></a></span
      >
    </h2>
    <div class="book-list">
      <% for (let novel of lightNovels) { %>
      <div class="book-item">
        <div class="book-cover">
          <a href="/novel/detail/<%= novel._id %>"
            ><img
              src="<%= getCoverUrl(novel) %>"
              alt="<%= novel.title %>の表紙"
          /></a>
          <form action="/user/bookmark" method="post">
            <button class="bookmark-button">読みたい＋</button>
          </form>
        </div>
        <p><%= novel.title %></p>
        <p><%= novel.author.author_name %></p>
      </div>
      <% } %>
    </div>

    <h2>
      ノベルバースおすすめ<span
        ><a href="/novel/list?is_recommend=true">もっと見る -></a></span
      >
    </h2>
    <div class="book-list">
      <% for (let novel of recommendedNovels) { %>
      <div class="book-item">
        <div class="book-cover">
          <a href="/novel/detail?id=<%= novel._id %>"
            ><img
              src="<%= getCoverUrl(novel) %>"
              alt="<%= novel.title %>の表紙"
          /></a>
          <form action="/user/bookmark" method="post">
            <button class="bookmark-button">読みたい＋</button>
          </form>
        </div>
        <p><%= novel.title %></p>
        <p><%= novel.author.author_name %></p>
      </div>
      <% } %>
    </div>
  </section>
</main>

<!-- 特定のJavaScript -->
<% scripts = '<script src="/js/home.js"></script>' %> 
<% scripts = '<script src="/js/bookmark.js"></script>' %>
